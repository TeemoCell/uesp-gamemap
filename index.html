<!DOCTYPE html>
<html>
   <head>
      <!-- TODO: Auto generate title -->
      <title>UESP:ESO Map</title>

      <!-- TODO: Add more generated meta tags here? -->
      <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
      <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

      <link rel="stylesheet" href="gamemap.css?date=15May2018" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@40,400,0,200" />
   
         
      <script type="text/javascript" src="libs/jQuery/jquery-1.10.2.js"></script>
      <script type="text/javascript" src="main.js"></script>
      <script type="text/javascript" src="common.js"></script>
      <script type="text/javascript" src="mapoptions.js?date=29march2014a"></script>
      <script type="text/javascript" src="mapstate.js?date=29march2014a"></script>
      <script type="text/javascript" src="location.js?date=3Sept2018"></script>
      <script type="text/javascript" src="world.js?date=25sept2017"></script>
      <script type="text/javascript" src="maptile.js?date=29march2014a"></script>
      <script type="text/javascript" src="gamemap.js?date=8Sept2018"></script>
      
      <!-- TODO: Replace this with a dynamic list -->
      <script type="text/javascript">
         var esoIconMap = {
               1  : "Artifact Gate",
               2  : "Bank",
               3  : "Battle",
               4  : "Border Keep",
               5  : "Caravan",
               6  : "Clothier",
               7  : "Dock",
               8  : "Elder Scroll",
               9  : "Farm",
               10 : "Forward Camp",
               11 : "Inn",
               12 : "Keep",
               13 : "Lumber Mill",
               14 : "Mine",
               15 : "Outpost",
               16 : "Smithy",
               17 : "Temple",
               18 : "Vendor",
               19 : "Wayshrine",
               20 : "Arcanist",
               21 : "Woodworker",
               22 : "Alchemist",
               23 : "Brewer",
               24 : "Armory",
               25 : "Pack Merchant",
               26 : "Banker",
               27 : "Outfitter",
               28 : "Cooking Fire",
               29 : "Enchanter",
               30 : "Fighters Guild",
               31 : "Hall Steward",
               32 : "Armorer",
               33 : "Tailor",
               34 : "Merchant",
               35 : "Mages Guild",
               36 : "Fishing Hole",
               37 : "Leatherworker",
               38 : "Perquisitor",
               39 : "Provisioner",
               40 : "Rededication Shrine",
               41 : "Stable Master",
               42 : "Weaponsmith",
               43 : "Travel NPC",
               44 : "Blacksmith",
               50 : "Area of Interest",
               51 : "Ayleid Ruin",
               52 : "Camp",
               53 : "Cave",
               54 : "Cemetary",
               55 : "City",
               56 : "Crafting Site",
               57 : "Crypt", 
               58 : "Daedric Ruin",
               59 : "Delve",
               60 : "Dwemer Ruin",
               61 : "Estate",
               62 : "Quest Start",
               63 : "Group Boss",
               64 : "Group Dungeon",
               65 : "Group Delve",
               66 : "Grove",
               67 : "Lighthouse",
               68 : "Mundus Stone",
               69 : "Dark Anchor",
               70 : "Public Dungeon",
               71 : "Ruin",
               72 : "Sewer",
               73 : "Tower",
               74 : "Town",
               75 : "Skyshard",
               76 : "Lore Book",
               77 : "Quest",
               78 : "Quest Door",
               79 : "Treasure Map",
               80 : "House",
               81 : "NPC",
               82 : "Named NPC",
               83 : "Chest",
               84 : "Alchemy Station",
               85 : "Enchanting Station",
               86 : "Blacksmith Station",
               87 : "Woodworking Station",
               88 : "Clothing Station",
               89 : "Heavy Sack",
               90 : "Crafting Node",
               91 : "Container",
               92 : "Artifact Gate (AD)",
               93 : "Artifact Gate (DC)",
               94 : "Artifact Gate (EP)",
               95 : "Artifact Temple (AD)",
               96 : "Artifact Temple (DC)",
               97 : "Artifact Temple (EP)",
               98 : "Border Keep (AD)",
               99 : "Border Keep (DC)",
               100: "Border Keep (EP)",
               101: "Cemetary (AD)",
               102: "Cemetary (DC)",
               103: "Cemetary (EP)",
               104: "Farm (AD)",
               105: "Farm (DC)",
               106: "Farm (EP)",
               107: "Keep (AD)",
               108: "Keep (DC)",
               109: "Keep (EP)",
               110: "Lumber Mill (AD)",
               111: "Lumber Mill (DC)",
               112: "Lumber Mill (EP)",
               113: "Mine (AD)",
               114: "Mine (DC)",
               115: "Mine (EP)",
               116: "Outpost (AD)",
               117: "Outpost (DC)",
               118: "Outpost (EP)",
               119: "Carpenter",
               120: "Armsman",
               121: "Chef",
               122: "Grocer",
               123: "Mystic",
               124: "Magus",
               125: "Innkeeper",
               126: "Boatswain",
               127: "Stables",
               128: "Celestial Rift",
               129: "Dark Fissure",
               130: "Magister",
               131: "Ayleid Well",
               132: "Misc",
               133: "Outlaws Refuge",
               134: "Guild Trader",
               135: "Outfit Station",
               136: "Dungeon",
               137: "Solo Instance",
               138: "Raid Dungeon",
               139: "Group Instance",
               140: "World Event",
               141: "Undaunted",
               142: "Moneylender",
               143: "Safebox",
               144: "Quest (Small)",
               145: "Fence",
               146: "Quest Door (Locked)",
               147: "Survey Map",
               148: "Stylemaster",
               149: "Ladder",
               150: "Sewer (AD)",
               151: "Sewer (EB)",
               152: "Sewer (DF)",
               153: "Safehouse",
               154: "Boneshard Vault",
               155: "Dark Ether Vault",
               156: "Mark Legion Vault",
               157: "Monstrous Tooth Vault",
               158: "Planar Armor Vault",
               159: "Tiny Claw Vault",
               160: "Daedric Ember Vault",
               161: "Daedric Shackles Vault",
               162: "Solo Trial",
               163: "Trophy",
               164: "Museum",
               165: "Thieves Guild",
               166: "Guild Trader (Small)",
               167: "Thieves Trove",
               168: "Quest Door (Trespass)",
               169: "Dark Brotherhood",
               170: "Hiding Spot",
               171: "Achievement",
               172: "Town (EP)",
               173: "Town (DC)",
               174: "Town (AD)",
               175: "Sewer (Group)",
               176: "Area of Interest (Group)",
               177: "Ayleid Ruin (Group)",
               178: "Camp (Group)",
               179: "Cave (Group)",
               180: "Cemetary (Group)",
               181: "Crypt (Group)",
               182: "Dwemer Ruin (Group)",
               183: "Estate (Group)",
               184: "Gate (Group)",
               185: "Keep (Group)",
               186: "Lighthouse (Group)",
               187: "Mine (Group)",
               188: "Ruin (Group)",
               189: "Horse Race",
               190: "Quest Start (Repeatable)",
               191: "Book / Note",
               192: "Furnisher (Achievement)",
               193: "Furnisher (Prestige)",
               194: "Furnisher (Home Goods)",
               195: "Fishing Hole (Ocean)",
               196: "Fishing Hole (River)",
               197: "Fishing Hole (Lake)",
               198: "Fishing Hole (Foul)",
               199: "Mastercraft Mediator",
               200: "Navigator",
               201: "Quartermaster",
               202: "Transmute Station",
               203: "Jeweler",
               204: "Psijic Portal",
               205: "Stairs Up",
               206: "Stairs Down",
               207: "Oneway West",
               208: "Oneway Southwest",
               209: "Oneway Southeast",
               210: "Oneway South",
               211: "Oneway Northwest",
               212: "Oneway Northeast",
               213: "Oneway North",
               214: "Oneway East",
               215: "Jewelry Station",
               216: "Imperial City Entrance",
               217: "Bridge",
               218: "Milegate",
               219: "Event Merchant",
               220: "Shrine",
               221: "Dragon",
               222: "Volendrung",
               223: "Blackreach Lift",
               224: "Nord Boat",
               225: "Furnisher (Battlegrounds)",
               226: "Battleground Merchant",
               227: "Antiquity",
               228: "Furnisher",
               229: "Quest (Story)",
         };
         
         var g_GameMap = null;
         var g_MapState = null;
         
         var g_DefaultMapOptions = {
               getMapTileFunction : getDefaultMapTile,
               wikiUrl: "//en.uesp.net/wiki/",
               mapUrl : "//esomap.uesp.net/esomap.html",
               missingMapTile:  "//maps.uesp.net/esomap/blacknulltile.jpg",
               iconPath: "icons/",
               wikiNamespace: "Online",
               iconTypeMap: esoIconMap,
               gamePosX1: 0,
               gamePosX2: 1000000,
               gamePosY1: 1000000,
               gamePosY2: 0,
               initialGamePosX : 400000,
               initialGamePosY : 600000,
               initialZoom : 10,
               tileCountX : 11,
               tileCountY : 9,
               mapLinkElement : '#gmMapLink',
               homeWorldId : 668,
               minValidWorldId : 50,
               maxValidWorldId : 20000,
               dbPrefix: "test",
               // --OFFLINE_OPTIONS--
         };
         
         if (g_DefaultMapOptions.isOffline) {
            g_DefaultMapOptions.getMapTileFunction = getDefaultMapTile_Offline;
            g_DefaultMapOptions.missingMapTile = "blacknulltile.jpg";
         }
         
         
         function onWorldLoad() {
            if (this.hasCenterOnParam()) return;
            
            defaultMapState = new uesp.gamemap.MapState();
            
            defaultMapState.worldId = 668;
            defaultMapState.zoomLevel = 9;
            defaultMapState.gamePos.x = 500000;
            defaultMapState.gamePos.y = 500000;
            
            mapState = this.getMapStateFromQuery(defaultMapState);
            this.setMapState(mapState);
         }
         
         function onPermLoad() {
            canEdit = this.canEdit() && !uesp.isMobileDevice();
            
            if (canEdit) {
               $("#gmMapEditButtons").show();
               $("#addLocationButton").show();
               $("#addPathButton").show();
               $("#addAreaButton").show();
               $("#editWorldButton").show();
               $("#showRecentChangeButton").show();
            }
            else {
               $("#addLocationButton").hide();
               $("#addPathButton").hide();
               $("#addAreaButton").hide();
               $("#editWorldButton").hide();
               $("#showRecentChangeButton").hide();
            }
            
            updateMenuBarHeight();
         }
         
         // on window resize
         $(window).resize( function(e) {
            updateMenuBarHeight();
         });
         
         
         function updateMenuBarHeight() {
            var menuBar = $("#menubar");
            var map = $('#gmMap');
            
            var height = menuBar.height();
            map.css('top', '' + height + 'px');
         }
         
         $( document ).ready( function() {
            userEvents = {
               onMapWorldsLoaded   : onWorldLoad,
               onPermissionsLoaded : onPermLoad,
               onMapWorldChanged   : onWorldChanged
            };
            
            g_GameMap = new uesp.gamemap.Map('gmMap', g_DefaultMapOptions, userEvents);
            
            if (g_GameMap.mapOptions.isOffline) {
               g_GameMap.worldGroupListContents = $("#gmMapListRoot").html();
               g_GameMap.createMapList($("#gmMapListRoot"));
               $('#gmMapList').html(g_GameMap.worldGroupListContents);
               g_GameMap.setEventsForMapGroupList();
            }
            else {
               // TODO: Change how map list is created
               g_GameMap.createMapList($("#gmMapListRoot"));

               // TODO: Temporary call to get the group-world list for ESO
               $.get( 'templates/worldgrouplist.txt', function( data ) {
                  g_GameMap.worldGroupListContents = data;
                  uesp.logDebug(uesp.LOG_LEVEL_INFO, 'Received world group list contents!');
                  $('#gmMapList').html(data);
                  g_GameMap.setEventsForMapGroupList();
               });			
            }
            
            updateMenuBarHeight();
         });
         
         function getDefaultMapTile(xPos, yPos, zoom, worldName) {
            return "//maps.uesp.net/esomap/" + worldName + "/zoom" + zoom + "/" + worldName + "-" + xPos + "-" + yPos + ".jpg";
         }
         
         function getDefaultMapTile_Offline(xPos, yPos, zoom, worldName) {
            return "" + worldName + "/zoom" + zoom + "/" + worldName + "-" + xPos + "-" + yPos + ".jpg";
         }
         
         // TODO: Move into Map class
         function onWorldChanged(newWorld) {
            foundListItems = $('#gmMapList li:contains("' + newWorld.displayName +'")').not('.gmMapListHeader');
            
            var foundListItem = null;
            var minTextLength = 1000;
            
            foundListItems.each(function( index ) {
               textLen = $(this).text().length;
               
               if (textLen < minTextLength) {
                  minTextLength = textLen;
                  foundListItem = $(this);
               }
            });
            
            if (foundListItem != null) {
               if (g_GameMap.mapListLastSelectedItem != null) g_GameMap.mapListLastSelectedItem.removeClass('gmMapListSelect');
               foundListItem.addClass('gmMapListSelect');
               g_GameMap.mapListLastSelectedItem = foundListItem;
               $(foundListItem).parents('ul:first').show();
            }
            
            $('#gmMapListAlphaSelect').val(newWorld.id);
            
            $('#gmMapNameLabel').text(newWorld.displayName);
         }
         
      </script>
   </head>

   <body>
      <div id="menubar">
         <li class="gmMenuItemTitle"><a href="//www.uesp.net/wiki/Main_Page"><b class="wikiTitle">UESP</b> | ESO Map</a></li>
         <ol class="gmMenuLinks">
            <li class="gmMenuItem" id="gmMapNameLabel" onclick="g_GameMap.showMapList();" ontouchstart="g_GameMap.showMapList();"></li>
            <li class="gmMenuItem gmNoMobile"><a title="Generate permalink to this location" href="" id="gmMapLink"><span class="material-symbols-outlined">Link</span></a></li>
            <li class="gmMenuItem gmNoMobile"><a title="Goto the wiki page for the current map" href="" id="gmMapWikiLink">Goto Page</a></li>
         </ol>
         <div id="gmMapListRoot" tabindex="0" style="display:none;">
            <!--OFFLINE_GROUPLIST-->
         </div>
         
         <div id="gmMenuLinksRight">
            <ol class="gmMenuLinks">
               <li class="gmMenuItem gmNoMobile" onclick="g_GameMap.showMapKey();" ontouchstart="g_GameMap.showMapKey();" id="gmMapShowKey">Key</li>
               <li class="gmMenuItem gmNoMobile" onclick="g_GameMap.showHelpBlock();" ontouchstart="g_GameMap.showHelpBlock();" id="gmHelp"><span class="material-symbols-outlined">help</span></li>
            </ol>
         </div>
         
         <div id="gmMapEditButtons" style="display:none;">
            <button id="editWorldButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onEditWorld();" ontouchstart="g_GameMap.onEditWorld();">Edit World</button>
            <button id="addLocationButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddLocationStart();"  ontouchstart="g_GameMap.onAddLocationStart();">Add Location</button>
            <button id="addPathButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddPathStart();"  ontouchstart="g_GameMap.onAddPathStart();">Add Path</button>
            <button id="addAreaButton" class="gmNoMobile" style="display:none;" onclick="g_GameMap.onAddAreaStart();"  ontouchstart="g_GameMap.onAddAreaStart();">Add Area</button>
            &nbsp;
            <div id="showRecentChangeButton" class="gmToggleButton gmNoMobile" style="display:none;" onclick="g_GameMap.onRecentChanges(this);" ontouchstart="g_GameMap.onRecentChanges(this);">Recent Changes</div>
         </div>
      </div>

      <!-- Map container -->
      <div id="gmMap"></div>

      <!-- Search container -->
      <div class = 'search_root' id="search_root">
         <div class='search_bar '>
            <div class="search_icon">
               <span class="material-symbols-outlined">search</span>
            </div>

            <div class='searchbox_container'>
               <input class='search_box' type='text' id='searchbox' placeholder="Where would you like to go?" size='25' maxlength='100' autocomplete='off' />
            </div>
    
            <div class='clear_search_container waves-effect waves-circle' >
               <button id="btn_clear_search" class='btn_bgless_icon_button hidedefault' name='button' title="Clear the current search" type='reset'><span class="material-symbols-outlined">close</span></button>
            </div>
         </div>

         <div class="loading_indicator"><div></div><div></div><div></div><div></div></div>

         <!-- <button id="btn_location_list" class='btn_icon_button' name='btn_location_list' title="Open location list" type='reset'><span class="material-symbols-outlined">assistant_direction</span></button> -->
      </div>

      <div class="infobar">
         <a href="//www.uesp.net/wiki/Main_Page" title="Go UESP home"><b class="wikiTitle">UESP</b></a>
         <b> | </b>
         <a href="" id="gmMapReset" title="Reset the map view">ESO Map</a>
         <b> | </b>
         <a href="//www.uesp.net/wiki/UESPWiki_talk:ESO_Map_Design" title="Give feedback about this map">Send Feedback</a>
       </div>

      <!-- Google Analytics stuff -->
      <script type="text/javascript">
         if (!g_DefaultMapOptions.isOffline) {
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-1386039-6']);
            _gaq.push(['_trackPageview']);
            
            (function() {
               var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
               ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
         }
      </script>

   </body>
</html>
